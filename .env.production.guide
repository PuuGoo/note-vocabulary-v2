# VocaPro - Production Environment Setup

## Production Environment Variables

Copy this to your `.env` file on VPS:

```env
# =====================================================
# VocaPro Production Environment Configuration
# =====================================================

# Database (Azure SQL Database)
# Replace with your actual Azure SQL credentials
DATABASE_URL="sqlserver://USERNAME:PASSWORD@SERVERNAME.database.windows.net:1433;database=DBNAME;encrypt=true;trustServerCertificate=false"

# Application
NODE_ENV=production
PORT=3000
HOST=0.0.0.0
BASE_URL=https://yourdomain.com  # Or http://your-vps-ip

# Session Secret (IMPORTANT: Change to a strong random string!)
# Generate: openssl rand -base64 32
SESSION_SECRET=CHANGE-THIS-TO-A-STRONG-RANDOM-STRING

# Redis (Session Storage)
REDIS_URL=redis://localhost:6379
# If Redis has password:
# REDIS_URL=redis://:your-password@localhost:6379

# Google OAuth (Optional)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=https://yourdomain.com/auth/google/callback

# Email (Optional - for magic link authentication)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
EMAIL_FROM=noreply@yourdomain.com

# Azure Storage (Optional - for media upload)
# AZURE_STORAGE_CONNECTION_STRING=your-azure-storage-connection-string
# AZURE_STORAGE_CONTAINER=vocapro-media

# API Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# TTS API (Optional)
# TTS_API_URL=https://api.text-to-speech.com/v1
# TTS_API_KEY=your-tts-api-key

# Logging
LOG_LEVEL=info
```

## Security Checklist

- [ ] Change `SESSION_SECRET` to a strong random string
- [ ] Use HTTPS in production (setup SSL certificate)
- [ ] Set strong password for Redis
- [ ] Configure firewall (UFW)
- [ ] Keep Node.js and dependencies updated
- [ ] Use environment variables for all secrets
- [ ] Enable Nginx security headers
- [ ] Setup fail2ban for SSH protection
- [ ] Regular backups of database
- [ ] Monitor logs regularly

## Generate Strong Secrets

```bash
# Generate SESSION_SECRET
openssl rand -base64 32

# Or using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

## Database Connection String Format

Azure SQL Database:
```
sqlserver://USERNAME:PASSWORD@SERVERNAME.database.windows.net:1433;database=DBNAME;encrypt=true;trustServerCertificate=false
```

Example:
```
sqlserver://admin:MyP@ssw0rd@vocapro.database.windows.net:1433;database=vocaprodb;encrypt=true;trustServerCertificate=false
```

**Note**: URL encode special characters in password!
- `@` ? `%40`
- `!` ? `%21`
- `#` ? `%23`

## Redis Security

1. Set password in Redis config:
```bash
sudo nano /etc/redis/redis.conf
```

Add:
```
requirepass your-strong-password
bind 127.0.0.1
```

2. Restart Redis:
```bash
sudo systemctl restart redis-server
```

3. Update .env:
```env
REDIS_URL=redis://:your-strong-password@localhost:6379
```

## Google OAuth Setup

1. Go to: https://console.cloud.google.com/
2. Create new project or select existing
3. Enable Google+ API
4. Create OAuth 2.0 credentials
5. Add authorized redirect URIs:
   - `https://yourdomain.com/auth/google/callback`
6. Copy Client ID and Client Secret to .env

## Email Setup (Gmail)

1. Enable 2-factor authentication on Gmail
2. Generate App Password: https://myaccount.google.com/apppasswords
3. Use App Password in SMTP_PASS

## Production Checklist

- [ ] All environment variables configured
- [ ] Database accessible from VPS
- [ ] Redis running and secured
- [ ] SSL certificate installed
- [ ] Nginx properly configured
- [ ] PM2 running application
- [ ] Firewall configured
- [ ] Application accessible via domain/IP
- [ ] Logs being written correctly
- [ ] Health endpoint responding: /health
